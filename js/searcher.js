const stemmer=e=>e.toLowerCase();function setCursorToEnd(e){const t=document.createRange(),n=window.getSelection();t.selectNodeContents(e),t.collapse(!1),n.removeAllRanges(),n.addRange(t),e.focus()}function searchFocus(){let e=document.getElementById("id-searchBox");const t=new KeyboardEvent("keypress",{key:" "});e.dispatchEvent(t),setCursorToEnd(e)}function searchKeyDown(){"Enter"===this.event.key&&(this.event.preventDefault(),searcher())}function openSearch(){return closeBoxes(),searchOpen?(document.getElementById("id-searchContainer").style.display="none",document.getElementById("id-pageContainer").style.display="block",document.getElementById("id-menu").style.display="block",void(searchOpen=!1)):(document.getElementById("id-pageContainer").style.display="none",document.getElementById("id-searchContainer").style.display="block",document.getElementById("id-menu").style.display="none",document.getElementById("id-searchBox").focus(),void(searchOpen=!0))}function createIndex(e){const t={};return e.forEach((e=>{const n=e.vid;e.vt.split(/\W+/).forEach((e=>{const s=stemmer(e);t[s]||(t[s]=[]),t[s].push(n)}))})),t}function searchPhrase(e,t){const n=t.toLowerCase(),s=n.split(/\W+/),d=s.map((e=>stemmer(e))).map((t=>new Set(e[t]||[]))).reduce(((e,t)=>new Set([...e].filter((e=>t.has(e)))))),r=Array.from(d),a=r.filter((e=>verses.find((t=>t.vid===e)).vt.includes(t))),c=r.filter((e=>verses.find((t=>t.vid===e)).vt.toLowerCase().includes(n))),o=r.filter((e=>{const t=verses.find((t=>t.vid===e)).vt.toLowerCase();return s.every((e=>t.includes(e)))})),l=verses.filter((e=>{const t=e.vt.toLowerCase();return s.every((e=>t.includes(e)))})).map((e=>e.vid));return[...new Set([...a,...c,...o,...l])]}function setSearchChapter(e){let t,n,s=verses[e].bid,d=verses[e].cn,r=verses[e].vn;return s<40?(t=oldBooks.findIndex((e=>e.id===s)),n=oldBooks):(t=newBooks.findIndex((e=>e.id===s)),n=newBooks),`${n[t].t} ${d}:${r}`}function getSearchVerses(e=searchResults){let t,n,s,d,r,a,c=0,o=searchResultIndex+30,l=document.getElementById("id-searchResults");for(e.length-searchResultIndex<30&&(o=e.length);searchResultIndex<o&&o<=e.length;)n=document.createElement("p"),n.classList.add("cs-searchVerse"),t=document.createElement("a"),t.addEventListener("click",(()=>{getSearchChapter(),this.event.preventDefault(),this.event.stopPropagation(),this.event.stopImmediatePropagation()})),c=e[searchResultIndex]-1,t.id=`id-searchVerse${verses[c].vid}`,t.textContent=setSearchChapter(c),t.dataset.bid=verses[c].bid,t.dataset.cn=verses[c].cn,t.dataset.vn=verses[c].vn,t.classList.add("cs-searchChapter"),n.appendChild(t),r=document.createElement("br"),n.appendChild(r),a=verses[c].vt.replace("`",""),a=a.replace("Â´",""),d=document.createTextNode(a),n.appendChild(d),l.appendChild(n),searchResultIndex++;s=document.createElement("hr"),l.appendChild(s),r=document.createElement("br"),l.appendChild(r);let i=e.length-searchResultIndex;0===i?(n=document.createElement("p"),n.textContent="There are no more results."):(t=document.createElement("a"),t.addEventListener("click",(()=>{getMoreResults(),this.event.preventDefault(),this.event.stopPropagation(),this.event.stopImmediatePropagation()})),t.textContent="More Results",t.classList.add("cs-searchResults"),l.appendChild(t),r=document.createElement("br"),l.appendChild(r),r=document.createElement("br"),l.appendChild(r),n=document.createElement("p"),n.textContent=`There are ${i} more results.`),l.appendChild(n),r=document.createElement("br"),l.appendChild(r),r=document.createElement("br"),l.appendChild(r)}function getMoreResults(){document.getElementById("id-loader").style.display="block",setTimeout((function(){getSearchVerses(),document.getElementById("id-loader").style.display="none"}),30)}function getSearchChapter(){let e=this.event.target.id,t=document.getElementById(e).dataset.bid,n=document.getElementById(e).dataset.cn,s=document.getElementById(e).dataset.vn;document.getElementById("id-MenuBtn4").textContent=s,activeBookID=`id-book${t}`,activeChapterID=`id-chapter${n}`,getChapter(),openSearch(),selectedVerseID=`id-versNumber${s}`;const d=document.getElementById(selectedVerseID),r=window.getSelection(),a=document.createRange();a.selectNodeContents(d),r.removeAllRanges(),r.addRange(a),d.scrollIntoView({block:"center"}),setQuerystring("vh",s)}async function searcher(){searchData=document.getElementById("id-searchBox").textContent,""!==searchData&&(document.getElementById("id-loader").style.display="block",setTimeout((function(){searchResultIndex=0,searchIndex||(searchIndex=createIndex(verses)),searchResults=searchPhrase(searchIndex,searchData),removeElements("id-searchResults"),getSearchVerses(searchResults),document.getElementById("id-loader").style.display="none"}),30))}